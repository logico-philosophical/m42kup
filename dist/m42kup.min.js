!function webpackUniversalModuleDefinition(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.m42kup=t():e.m42kup=t()}("undefined"!=typeof self?self:this,(function(){return function(e){var t={};function __webpack_require__(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,__webpack_require__),n.l=!0,n.exports}return __webpack_require__.m=e,__webpack_require__.c=t,__webpack_require__.d=function(e,t,r){__webpack_require__.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},__webpack_require__.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},__webpack_require__.t=function(e,t){if(1&t&&(e=__webpack_require__(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(__webpack_require__.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)__webpack_require__.d(r,n,function(t){return e[t]}.bind(null,n));return r},__webpack_require__.n=function(e){var t=e&&e.__esModule?function getDefault(){return e.default}:function getModuleExports(){return e};return __webpack_require__.d(t,"a",t),t},__webpack_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=8)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class Node{toString(){return this.toIndentedString(0)}}},function(e,t,r){"use strict";var n,i,a,o,l,s,p,u,c,f=this&&this.__classPrivateFieldSet||function(e,t,r){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,r),r},h=this&&this.__classPrivateFieldGet||function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.isElementDisplayType=void 0;const g=d(r(3)),m=d(r(4)),$=d(r(5)),y=d(r(0)),b=d(r(6));function isElementDisplayType(e){return["inline","leaf-block","container-block"].includes(e)}t.isElementDisplayType=isElementDisplayType;class Element extends y.default{constructor({name:e,display:t,renderer:r,split:f,code:h,attributes:d,children:m,options:$}){if(super(),this.innerIsRendered=!1,n.set(this,void 0),i.set(this,void 0),a.set(this,void 0),this.outerIsRendered=!1,o.set(this,void 0),l.set(this,void 0),s.set(this,void 0),p.set(this,void 0),u.set(this,void 0),c.set(this,void 0),this.innerIsRendered=!1,n.set(this,void 0),i.set(this,void 0),a.set(this,void 0),this.outerIsRendered=!1,o.set(this,void 0),l.set(this,void 0),s.set(this,void 0),p.set(this,void 0),u.set(this,void 0),c.set(this,void 0),!e)throw TypeError("You give arg0 a bad name");if(!isElementDisplayType(t))throw TypeError('arg0.display should be one of "inline", "leaf-block", or "container-block".');if(!(r instanceof Function))throw TypeError("arg0.render should be a function");if("string"!=typeof h)throw TypeError("You give arg0 a bad code");if(!(d instanceof Array))throw TypeError("attributes should be an array");if((()=>{var foo=e=>e instanceof Element||e instanceof b.default||e instanceof g.default||e instanceof Array&&e.every(foo);if(!m.every(foo))throw TypeError("All arg0.children should either be an Element, a TextNode, or an ErrorNode")})(),f||(f=[]),"string"==typeof f&&(f=[f]),!(f instanceof Array))throw TypeError("arg0.split should be either undefined, a string, or an array");this.name=e,this.display=t,this.renderer=r,this.split=f,this.code=h,this.attributes=d,this.children=m,this.options=$}renderInner(){this.innerIsRendered||((()=>{var e=this.split?this.split.length:0;!function recurse(e,t){if(t>0)return e.forEach((e=>{recurse(e,t-1)}));e.forEach((e=>{e instanceof Element&&e.render()}))}(this.children,e)})(),f(this,n,(()=>{var e=this.split?this.split.length:0,foo=(e,t)=>t>0?e.map((e=>foo(e,t-1))):e.map((e=>{if(e instanceof b.default)return!0;if(e instanceof g.default)return!1;if(e instanceof Element)return e.outerIsText;throw Error("wut")})).every((e=>e));return foo(this.children,e)})()),f(this,i,(()=>{var e=this.split?this.split.length:0,foo=(e,t,r)=>t>0?e.map(((e,n)=>foo(e,t-1,r[n]))):r?e.map((e=>e instanceof b.default?e.text:e.outerText)).join(""):null;return foo(this.children,e,h(this,n))})()),f(this,a,(()=>{var e=this.split?this.split.length:0,foo=(e,t,r,n)=>{if(t>0)return e.map(((e,i)=>foo(e,t-1,r[i],n[i])));if(r)return n.trim()&&"container-block"==this.display?n.split(/(?:\r\n[ \t]*){2,}|(?:\r[ \t]*){2,}|(?:\n[ \t]*){2,}/).filter((e=>!!e.trim())).map(m.default).map((e=>`<p>${e}</p>`)).join(""):m.default(n);if("container-block"!=this.display)return e.map((e=>e instanceof b.default?m.default(e.text):e instanceof g.default?e.toHtml():e.outerHtml)).join("");var i=[],a=[],commit=()=>{a.length&&(i.push(a),a=[])},add=e=>a.push(e);return e.forEach((e=>{if(e instanceof b.default){var t=e.text.split(/(?:\r\n[ \t]*){2,}|(?:\r[ \t]*){2,}|(?:\n[ \t]*){2,}/);if(t.length<2)return add(e);t.forEach(((e,r)=>{e.trim()&&add(this.text(e)),r<t.length-1&&commit()}))}else e instanceof g.default?add(e):"inline"!=e.display?(commit(),i.push(e),commit()):add(e)})),commit(),i.map((e=>e instanceof Array?"<p>"+e.map((e=>e instanceof b.default?m.default(e.text):e instanceof g.default?e.toHtml():e.outerHtml)).join("")+"</p>":e.outerHtml)).join("")};return foo(this.children,e,h(this,n),h(this,i))})()),this.innerIsRendered=!0)}get innerIsText(){if(!this.innerIsRendered)throw Error("Cannot access Element#innerIsText before it is initialized");return h(this,n)}get innerText(){if(!this.innerIsRendered)throw Error("Cannot access Element#innerText before it is initialized");return h(this,i)}get innerHtml(){if(!this.innerIsRendered)throw Error("Cannot access Element#innerHtml before it is initialized");return h(this,a)}render(){if(this.outerIsRendered)return h(this,o);this.renderInner();var e=this.renderer(this,this.options);if(f(this,o,e),f(this,l,e instanceof b.default),f(this,s,e instanceof b.default?e.text:null),f(this,p,e instanceof g.default),f(this,u,e instanceof g.default?e.message:null),h(this,l))f(this,c,m.default(h(this,s)));else if(e instanceof $.default)f(this,c,e.html);else{if(!(e instanceof g.default))throw TypeError("Render output should be one of TextNode, HtmlNode, or ErrorNode");f(this,c,e.toHtml())}this.outerIsRendered=!0}get outerIsText(){if(!this.outerIsRendered)throw Error("Cannot access Element#outerIsText before it is initialized");return h(this,l)}get outerText(){if(!this.outerIsRendered)throw Error("Cannot access Element#outerText before it is initialized");return h(this,s)}get outerHtml(){if(!this.outerIsRendered)throw Error("Cannot access Element#outerHtml before it is initialized");return h(this,c)}get isError(){if(!this.outerIsRendered)throw Error("Cannot access Element#isError before it is initialized");return h(this,p)}get errorMessage(){if(!this.outerIsRendered)throw Error("Cannot access Element#errorMessage before it is initialized");return h(this,u)}text(e){return new b.default(e)}html(e){return new $.default({html:e,display:this.display})}error(e){return new g.default({message:`[${this.name}]: ${e}`,code:this.code})}getAttribute(e){for(var t=0;t<this.attributes.length;t++)if(this.attributes[t].name==e)return this.attributes[t].value;return null}toIndentedString(e){var t=["display","split","code","attributes","innerIsText","innerText","innerHtml","outerIsText","outerText","outerHtml","isError","errorMessage"].map((e=>e+"="+("string"==typeof this[e]||this[e]instanceof Array?JSON.stringify(this[e]):this[e]+""))).join("\n"+"\t".repeat(e+1)),r=function recurse(e,t){return e.map((e=>e instanceof Array?["[","\t"+recurse(e,t+1),"]"].join("\n"+"\t".repeat(t)):e.toIndentedString(t))).join(",\n"+"\t".repeat(t))}(this.children,e+1);return`Element[${JSON.stringify(this.name)}](\n${"\t".repeat(e+1)}${t}\n${"\t".repeat(e)}) {\n`+"\t".repeat(e+1)+`${r}\n`+`${"\t".repeat(e)}}`}escapeHtml(e){return m.default(e)}}t.default=Element,new WeakMap,new WeakMap,new WeakMap,new WeakMap,new WeakMap,new WeakMap,new WeakMap,new WeakMap,new WeakMap,n=new WeakMap,i=new WeakMap,a=new WeakMap,o=new WeakMap,l=new WeakMap,s=new WeakMap,p=new WeakMap,u=new WeakMap,c=new WeakMap},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0});const o=a(r(1));t.default=class ElementClass{constructor({name:e,display:t,renderer:r,split:n}){if(!e)throw TypeError("You give arg0 a bad name");if(!o.isElementDisplayType(t))throw TypeError('arg0.display should be one of "inline", "leaf-block", or "container-block".');if(!(r instanceof Function))throw TypeError("arg0.render should be a function");if([this.name,this.display]=[e,t],this.renderer=(e,t)=>{if(!(e instanceof o.default))throw TypeError("arg0 should be an instance of m42kup.renderer.Element");return r(e,t)},n||(n=[]),"string"==typeof n&&(n=[n]),!(n instanceof Array))throw TypeError("arg0.split should be either undefined, a string, or an array");this.split=n}instantiate({code:e,attributes:t,children:r,options:n}){return new o.default({name:this.name,display:this.display,renderer:this.renderer,split:this.split,code:e,attributes:t,children:r,options:n})}}},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(r(4)),a=n(r(0));class ErrorNode extends a.default{constructor({message:e,code:t}){if(super(),"string"!=typeof e)throw TypeError("message not string");if("string"!=typeof t)throw TypeError("code not string");this.message=e,this.code=t}toHtml(){return`<code class="m42kup-error" title="Error: ${i.default(this.message)}">${i.default(this.code)}</code>`}toIndentedString(e){return`Error(${["message","code"].map((e=>e+"="+JSON.stringify(this[e]))).join(" ")})`}}t.default=ErrorNode},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function escapeHtml(e){return(e+"").replace(/[&<>"']/g,(e=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[e])))}},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=r(1),a=n(r(0));class HtmlNode extends a.default{constructor({html:e,display:t}){if(super(),"string"!=typeof e)throw TypeError("html not string");if(!i.isElementDisplayType(t))throw TypeError('arg0.display should be one of "inline", "leaf-block", or "container-block".');this.html=e,this.display=t}toIndentedString(e){return`Html(${["display"].map((e=>e+"="+JSON.stringify(this[e]))).join(" ")}) {${JSON.stringify(this.html)}}`}}t.default=HtmlNode},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(r(0));class TextNode extends i.default{constructor(e){if(super(),"string"!=typeof e)throw TypeError("text not string");this.text=e}toIndentedString(e){return`Text {${JSON.stringify(this.text)}}`}}t.default=TextNode},function(e,t,r){"use strict";function shallow(e){var t={};for(var r in e)t[r]=e[r];return t}function copyOptions(e){var t={};return e.tags&&(t.tags=shallow(e.tags)),e.hljs&&(t.hljs=e.hljs),e.katex&&(t.katex=e.katex),t}function tags(e,t){for(var r in e=shallow(e),t)e[r]=t[r];return e}Object.defineProperty(t,"__esModule",{value:!0}),t.default={copyOptions:copyOptions,tags:tags,options:function options(e,t){if("object"!=typeof e||"object"!=typeof t)throw TypeError("One of the options provided is not an object");return e=copyOptions(e),t.tags&&(e.tags||(e.tags={}),e.tags=tags(e.tags,t.tags)),t.hljs&&(e.hljs=t.hljs),t.katex&&(e.katex=t.katex),e}}},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(r(9)),a=n(r(11)),o=n(r(13)),l=n(r(7)),s=n(r(14));var p={};var u={parser:i.default,renderer:a.default,highlighter:o.default,ast2nt:function ast2nt(e,t){return t||(t={}),t.tags||(t.tags={}),t=l.default.options(p,t),a.default.ast2nt(e,t)},render:function render(e,t){e+="",t||(t={}),t.tags||(t.tags={}),t=l.default.options(p,t);var r=i.default.input2pt(e),n=i.default.pt2ast(r);return a.default.ast2nt(n,t).outerHtml},highlight:function highlight(e){e+="";var t=i.default.input2pt(e);return o.default.pt2hl(t)},cascade:function cascadeOptions(e){if("object"!=typeof e)throw TypeError("typeof options != 'object'");p=l.default.options(p,e)},set:function setOptions(e){if("object"!=typeof e)throw TypeError("typeof options != 'object'");p=e},addCodeMirrorMode:s.default};e.exports=u},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(r(10));t.default={input2pt:function input2pt(e){var t=i.default.parse(e);return t.input=e,t},pt2ast:function pt2ast(e){var t=e.input,r=function recurse(e){var r=e.map((e=>{switch(e.type){case"text":return{type:"text",text:e.text};case"verbatim":return{type:"text",text:e.child.text};case"element":var r="parenthesis"!=e.attributes._type?[]:e.attributes.content.filter((({_type:e})=>"attribute"==e)).map((({attribute:e})=>({name:e[0],value:e[3]})));return{type:"element",name:e.name,attributes:r,code:t.substring(e.location.start.offset,e.location.end.offset),children:recurse(e.children)};default:throw new TypeError(`Unknown type: ${e.type}`)}}));return r=r.reduce(((e,t)=>{if("text"==t.type){if(!t.text)return e;if(e.length&&"text"==e[e.length-1].type)return e[e.length-1].text+=t.text,e}return e.push(t),e}),[])}(e.root.children);return{input:e.input,root:{type:"root",children:r,code:t}}}}},function(e,t,r){"use strict";function peg$SyntaxError(e,t,r,n){this.message=e,this.expected=t,this.found=r,this.location=n,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,peg$SyntaxError)}!function peg$subclass(e,t){function ctor(){this.constructor=e}ctor.prototype=t.prototype,e.prototype=new ctor}(peg$SyntaxError,Error),peg$SyntaxError.buildMessage=function(e,t){var r={literal:function(e){return'"'+literalEscape(e.text)+'"'},class:function(e){var t,r="";for(t=0;t<e.parts.length;t++)r+=e.parts[t]instanceof Array?classEscape(e.parts[t][0])+"-"+classEscape(e.parts[t][1]):classEscape(e.parts[t]);return"["+(e.inverted?"^":"")+r+"]"},any:function(e){return"any character"},end:function(e){return"end of input"},other:function(e){return e.description}};function hex(e){return e.charCodeAt(0).toString(16).toUpperCase()}function literalEscape(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+hex(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+hex(e)}))}function classEscape(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+hex(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+hex(e)}))}return"Expected "+function describeExpected(e){var t,n,i,a=new Array(e.length);for(t=0;t<e.length;t++)a[t]=(i=e[t],r[i.type](i));if(a.sort(),a.length>0){for(t=1,n=1;t<a.length;t++)a[t-1]!==a[t]&&(a[n]=a[t],n++);a.length=n}switch(a.length){case 1:return a[0];case 2:return a[0]+" or "+a[1];default:return a.slice(0,-1).join(", ")+", or "+a[a.length-1]}}(e)+" but "+function describeFound(e){return e?'"'+literalEscape(e)+'"':"end of input"}(t)+" found."},e.exports={SyntaxError:peg$SyntaxError,parse:function peg$parse(e,t){t=void 0!==t?t:{};var r,n={},i={start:peg$parsestart},a=peg$parsestart,o=peg$literalExpectation("[",!1),l="<",s=peg$literalExpectation("<",!1),p="!",u=peg$literalExpectation("!",!1),c='"',f=peg$literalExpectation('"',!1),h="#",d=peg$literalExpectation("#",!1),g="$",m=peg$literalExpectation("$",!1),$="%",y=peg$literalExpectation("%",!1),b="&",v=peg$literalExpectation("&",!1),x="'",_=peg$literalExpectation("'",!1),A=")",E=peg$literalExpectation(")",!1),k="*",w=peg$literalExpectation("*",!1),C="+",T=peg$literalExpectation("+",!1),j=",",M=peg$literalExpectation(",",!1),H="-",O=peg$literalExpectation("-",!1),I="/",q=peg$literalExpectation("/",!1),S=";",N=peg$literalExpectation(";",!1),z="=",P=peg$literalExpectation("=",!1),R=">",D=peg$literalExpectation(">",!1),F="?",W=peg$literalExpectation("?",!1),U="@",L=peg$literalExpectation("@",!1),J="\\",Y=peg$literalExpectation("\\",!1),B="^",G=peg$literalExpectation("^",!1),K="_",Q=peg$literalExpectation("_",!1),V="{",X=peg$literalExpectation("{",!1),Z="|",ee=peg$literalExpectation("|",!1),te="}",re=peg$literalExpectation("}",!1),ne="~",ie=peg$literalExpectation("~",!1),ae=/^[a-z]/,oe=peg$classExpectation([["a","z"]],!1,!1),le=/^[a-z0-9]/,se=peg$classExpectation([["a","z"],["0","9"]],!1,!1),pe=":",ue=peg$literalExpectation(":",!1),peg$c65=function(e,t,r,n){return":"+r+n.join("")},ce="",fe=peg$literalExpectation("(",!1),he=/^[a-z0-9\-]/,de=peg$classExpectation([["a","z"],["0","9"],"-"],!1,!1),ge={type:"any"},peg$c74=function(e,t,r,n,i,a){return[r,n,i,a]},me=/^['"()[\] \t\n\r]/,$e=peg$classExpectation(["'",'"',"(",")","[","]"," ","\t","\n","\r"],!1,!1),peg$c77=function(e,t,r,n){return[r,"",n,""]},peg$c79=function(e,t,r){return{_type:"attribute",attribute:[t].concat(r)}},peg$c80=function(e,t){return{_type:"whitespace",whitespace:t}},peg$c81=function(e,t){return{_type:"error",error:t}},ye=".",be=peg$literalExpectation(".",!1),ve=peg$literalExpectation("]",!1),xe="`",_e=peg$literalExpectation("`",!1),peg$c96=function(e){return{type:"text",text:e.join(""),location:location()}},Ae=/^[ \t\n\r]/,Ee=peg$classExpectation([" ","\t","\n","\r"],!1,!1),ke=0,we=0,Ce=[{line:1,column:1}],Te=0,je=[],Me=0;if("startRule"in t){if(!(t.startRule in i))throw new Error("Can't start parsing from rule \""+t.startRule+'".');a=i[t.startRule]}function location(){return peg$computeLocation(we,ke)}function peg$literalExpectation(e,t){return{type:"literal",text:e,ignoreCase:t}}function peg$classExpectation(e,t,r){return{type:"class",parts:e,inverted:t,ignoreCase:r}}function peg$computePosDetails(t){var r,n=Ce[t];if(n)return n;for(r=t-1;!Ce[r];)r--;for(n={line:(n=Ce[r]).line,column:n.column};r<t;)10===e.charCodeAt(r)?(n.line++,n.column=1):n.column++,r++;return Ce[t]=n,n}function peg$computeLocation(e,t){var r=peg$computePosDetails(e),n=peg$computePosDetails(t);return{start:{offset:e,line:r.line,column:r.column},end:{offset:t,line:n.line,column:n.column}}}function peg$fail(e){ke<Te||(ke>Te&&(Te=ke,je=[]),je.push(e))}function peg$buildStructuredError(e,t,r){return new peg$SyntaxError(peg$SyntaxError.buildMessage(e,t),e,t,r)}function peg$parsestart(){var e,t;return e=ke,(t=peg$parsethings())!==n&&(we=e,t={root:{type:"root",children:t,location:location()}}),e=t}function peg$parsethings(){var e,t;for(e=[],t=peg$parsething();t!==n;)e.push(t),t=peg$parsething();return e}function peg$parsething(){var t;return(t=function peg$parseelement(){var t,r,i,a,o,l;t=ke,(r=function peg$parselbm_push(){var e,t;e=ke,(t=peg$parselbm())!==n&&(we=e,r=t,Oe.push(r.length),t=r);var r;return e=t}())!==n&&(i=function peg$parsetag_name(){var t,r,i,a,o,l,s,fe,he,de;t=ke,r=[],33===e.charCodeAt(ke)?(i=p,ke++):(i=n,0===Me&&peg$fail(u));if(i!==n)for(;i!==n;)r.push(i),33===e.charCodeAt(ke)?(i=p,ke++):(i=n,0===Me&&peg$fail(u));else r=n;if(r===n){if(r=[],34===e.charCodeAt(ke)?(i=c,ke++):(i=n,0===Me&&peg$fail(f)),i!==n)for(;i!==n;)r.push(i),34===e.charCodeAt(ke)?(i=c,ke++):(i=n,0===Me&&peg$fail(f));else r=n;if(r===n){if(r=[],35===e.charCodeAt(ke)?(i=h,ke++):(i=n,0===Me&&peg$fail(d)),i!==n)for(;i!==n;)r.push(i),35===e.charCodeAt(ke)?(i=h,ke++):(i=n,0===Me&&peg$fail(d));else r=n;if(r===n){if(r=[],36===e.charCodeAt(ke)?(i=g,ke++):(i=n,0===Me&&peg$fail(m)),i!==n)for(;i!==n;)r.push(i),36===e.charCodeAt(ke)?(i=g,ke++):(i=n,0===Me&&peg$fail(m));else r=n;if(r===n){if(r=[],37===e.charCodeAt(ke)?(i=$,ke++):(i=n,0===Me&&peg$fail(y)),i!==n)for(;i!==n;)r.push(i),37===e.charCodeAt(ke)?(i=$,ke++):(i=n,0===Me&&peg$fail(y));else r=n;if(r===n){if(r=[],38===e.charCodeAt(ke)?(i=b,ke++):(i=n,0===Me&&peg$fail(v)),i!==n)for(;i!==n;)r.push(i),38===e.charCodeAt(ke)?(i=b,ke++):(i=n,0===Me&&peg$fail(v));else r=n;if(r===n){if(r=[],39===e.charCodeAt(ke)?(i=x,ke++):(i=n,0===Me&&peg$fail(_)),i!==n)for(;i!==n;)r.push(i),39===e.charCodeAt(ke)?(i=x,ke++):(i=n,0===Me&&peg$fail(_));else r=n;if(r===n){if(r=[],41===e.charCodeAt(ke)?(i=A,ke++):(i=n,0===Me&&peg$fail(E)),i!==n)for(;i!==n;)r.push(i),41===e.charCodeAt(ke)?(i=A,ke++):(i=n,0===Me&&peg$fail(E));else r=n;if(r===n){if(r=[],42===e.charCodeAt(ke)?(i=k,ke++):(i=n,0===Me&&peg$fail(w)),i!==n)for(;i!==n;)r.push(i),42===e.charCodeAt(ke)?(i=k,ke++):(i=n,0===Me&&peg$fail(w));else r=n;if(r===n){if(r=[],43===e.charCodeAt(ke)?(i=C,ke++):(i=n,0===Me&&peg$fail(T)),i!==n)for(;i!==n;)r.push(i),43===e.charCodeAt(ke)?(i=C,ke++):(i=n,0===Me&&peg$fail(T));else r=n;if(r===n){if(r=[],44===e.charCodeAt(ke)?(i=j,ke++):(i=n,0===Me&&peg$fail(M)),i!==n)for(;i!==n;)r.push(i),44===e.charCodeAt(ke)?(i=j,ke++):(i=n,0===Me&&peg$fail(M));else r=n;if(r===n){if(r=[],45===e.charCodeAt(ke)?(i=H,ke++):(i=n,0===Me&&peg$fail(O)),i!==n)for(;i!==n;)r.push(i),45===e.charCodeAt(ke)?(i=H,ke++):(i=n,0===Me&&peg$fail(O));else r=n;if(r===n){if(r=[],47===e.charCodeAt(ke)?(i=I,ke++):(i=n,0===Me&&peg$fail(q)),i!==n)for(;i!==n;)r.push(i),47===e.charCodeAt(ke)?(i=I,ke++):(i=n,0===Me&&peg$fail(q));else r=n;if(r===n){if(r=[],59===e.charCodeAt(ke)?(i=S,ke++):(i=n,0===Me&&peg$fail(N)),i!==n)for(;i!==n;)r.push(i),59===e.charCodeAt(ke)?(i=S,ke++):(i=n,0===Me&&peg$fail(N));else r=n;if(r===n){if(r=[],61===e.charCodeAt(ke)?(i=z,ke++):(i=n,0===Me&&peg$fail(P)),i!==n)for(;i!==n;)r.push(i),61===e.charCodeAt(ke)?(i=z,ke++):(i=n,0===Me&&peg$fail(P));else r=n;if(r===n){if(r=[],62===e.charCodeAt(ke)?(i=R,ke++):(i=n,0===Me&&peg$fail(D)),i!==n)for(;i!==n;)r.push(i),62===e.charCodeAt(ke)?(i=R,ke++):(i=n,0===Me&&peg$fail(D));else r=n;if(r===n){if(r=[],63===e.charCodeAt(ke)?(i=F,ke++):(i=n,0===Me&&peg$fail(W)),i!==n)for(;i!==n;)r.push(i),63===e.charCodeAt(ke)?(i=F,ke++):(i=n,0===Me&&peg$fail(W));else r=n;if(r===n){if(r=[],64===e.charCodeAt(ke)?(i=U,ke++):(i=n,0===Me&&peg$fail(L)),i!==n)for(;i!==n;)r.push(i),64===e.charCodeAt(ke)?(i=U,ke++):(i=n,0===Me&&peg$fail(L));else r=n;if(r===n){if(r=[],92===e.charCodeAt(ke)?(i=J,ke++):(i=n,0===Me&&peg$fail(Y)),i!==n)for(;i!==n;)r.push(i),92===e.charCodeAt(ke)?(i=J,ke++):(i=n,0===Me&&peg$fail(Y));else r=n;if(r===n){if(r=[],94===e.charCodeAt(ke)?(i=B,ke++):(i=n,0===Me&&peg$fail(G)),i!==n)for(;i!==n;)r.push(i),94===e.charCodeAt(ke)?(i=B,ke++):(i=n,0===Me&&peg$fail(G));else r=n;if(r===n){if(r=[],95===e.charCodeAt(ke)?(i=K,ke++):(i=n,0===Me&&peg$fail(Q)),i!==n)for(;i!==n;)r.push(i),95===e.charCodeAt(ke)?(i=K,ke++):(i=n,0===Me&&peg$fail(Q));else r=n;if(r===n){if(r=[],123===e.charCodeAt(ke)?(i=V,ke++):(i=n,0===Me&&peg$fail(X)),i!==n)for(;i!==n;)r.push(i),123===e.charCodeAt(ke)?(i=V,ke++):(i=n,0===Me&&peg$fail(X));else r=n;if(r===n){if(r=[],124===e.charCodeAt(ke)?(i=Z,ke++):(i=n,0===Me&&peg$fail(ee)),i!==n)for(;i!==n;)r.push(i),124===e.charCodeAt(ke)?(i=Z,ke++):(i=n,0===Me&&peg$fail(ee));else r=n;if(r===n){if(r=[],125===e.charCodeAt(ke)?(i=te,ke++):(i=n,0===Me&&peg$fail(re)),i!==n)for(;i!==n;)r.push(i),125===e.charCodeAt(ke)?(i=te,ke++):(i=n,0===Me&&peg$fail(re));else r=n;if(r===n)if(r=[],126===e.charCodeAt(ke)?(i=ne,ke++):(i=n,0===Me&&peg$fail(ie)),i!==n)for(;i!==n;)r.push(i),126===e.charCodeAt(ke)?(i=ne,ke++):(i=n,0===Me&&peg$fail(ie));else r=n}}}}}}}}}}}}}}}}}}}}}}}t=r!==n?e.substring(t,ke):r;if(t===n){if(t=ke,ae.test(e.charAt(ke))?(r=e.charAt(ke),ke++):(r=n,0===Me&&peg$fail(oe)),r!==n){for(i=ke,a=[],le.test(e.charAt(ke))?(o=e.charAt(ke),ke++):(o=n,0===Me&&peg$fail(se));o!==n;)a.push(o),le.test(e.charAt(ke))?(o=e.charAt(ke),ke++):(o=n,0===Me&&peg$fail(se));if((i=a!==n?e.substring(i,ke):a)!==n){if(a=ke,o=[],l=ke,58===e.charCodeAt(ke)?(s=pe,ke++):(s=n,0===Me&&peg$fail(ue)),s!==n)if(ae.test(e.charAt(ke))?(fe=e.charAt(ke),ke++):(fe=n,0===Me&&peg$fail(oe)),fe!==n){for(he=[],le.test(e.charAt(ke))?(de=e.charAt(ke),ke++):(de=n,0===Me&&peg$fail(se));de!==n;)he.push(de),le.test(e.charAt(ke))?(de=e.charAt(ke),ke++):(de=n,0===Me&&peg$fail(se));he!==n?(we=l,l=s=peg$c65(0,0,fe,he)):(ke=l,l=n)}else ke=l,l=n;else ke=l,l=n;for(;l!==n;)if(o.push(l),l=ke,58===e.charCodeAt(ke)?(s=pe,ke++):(s=n,0===Me&&peg$fail(ue)),s!==n)if(ae.test(e.charAt(ke))?(fe=e.charAt(ke),ke++):(fe=n,0===Me&&peg$fail(oe)),fe!==n){for(he=[],le.test(e.charAt(ke))?(de=e.charAt(ke),ke++):(de=n,0===Me&&peg$fail(se));de!==n;)he.push(de),le.test(e.charAt(ke))?(de=e.charAt(ke),ke++):(de=n,0===Me&&peg$fail(se));he!==n?(we=l,l=s=peg$c65(0,0,fe,he)):(ke=l,l=n)}else ke=l,l=n;else ke=l,l=n;(a=o!==n?e.substring(a,ke):o)!==n?(we=t,t=r=r+i+a):(ke=t,t=n)}else ke=t,t=n}else ke=t,t=n;t===n&&(t=ce)}return t}())!==n&&(a=function peg$parseattributes(){var t,r,i,a,o,l,s,p,u,h,d,g,m;t=ke,40===e.charCodeAt(ke)?(r="(",ke++):(r=n,0===Me&&peg$fail(fe));if(r!==n){if(i=[],a=ke,o=ke,l=[],he.test(e.charAt(ke))?(s=e.charAt(ke),ke++):(s=n,0===Me&&peg$fail(de)),s!==n)for(;s!==n;)l.push(s),he.test(e.charAt(ke))?(s=e.charAt(ke),ke++):(s=n,0===Me&&peg$fail(de));else l=n;if((o=l!==n?e.substring(o,ke):l)!==n){if(l=ke,61===e.charCodeAt(ke)?(s=z,ke++):(s=n,0===Me&&peg$fail(P)),s!==n)if(34===e.charCodeAt(ke)?(p=c,ke++):(p=n,0===Me&&peg$fail(f)),p!==n){for(u=ke,h=[],d=ke,g=ke,Me++,34===e.charCodeAt(ke)?(m=c,ke++):(m=n,0===Me&&peg$fail(f)),Me--,m===n?g=void 0:(ke=g,g=n),g!==n?(e.length>ke?(m=e.charAt(ke),ke++):(m=n,0===Me&&peg$fail(ge)),m!==n?d=g=[g,m]:(ke=d,d=n)):(ke=d,d=n);d!==n;)h.push(d),d=ke,g=ke,Me++,34===e.charCodeAt(ke)?(m=c,ke++):(m=n,0===Me&&peg$fail(f)),Me--,m===n?g=void 0:(ke=g,g=n),g!==n?(e.length>ke?(m=e.charAt(ke),ke++):(m=n,0===Me&&peg$fail(ge)),m!==n?d=g=[g,m]:(ke=d,d=n)):(ke=d,d=n);(u=h!==n?e.substring(u,ke):h)!==n?(34===e.charCodeAt(ke)?(h=c,ke++):(h=n,0===Me&&peg$fail(f)),h===n&&(h=ke,(d=peg$parseEOF())!==n&&(we=h,d=""),h=d),h!==n?(we=l,l=s=peg$c74(0,0,s,p,u,h)):(ke=l,l=n)):(ke=l,l=n)}else ke=l,l=n;else ke=l,l=n;if(l===n){if(l=ke,61===e.charCodeAt(ke)?(s=z,ke++):(s=n,0===Me&&peg$fail(P)),s!==n)if(39===e.charCodeAt(ke)?(p=x,ke++):(p=n,0===Me&&peg$fail(_)),p!==n){for(u=ke,h=[],d=ke,g=ke,Me++,39===e.charCodeAt(ke)?(m=x,ke++):(m=n,0===Me&&peg$fail(_)),Me--,m===n?g=void 0:(ke=g,g=n),g!==n?(e.length>ke?(m=e.charAt(ke),ke++):(m=n,0===Me&&peg$fail(ge)),m!==n?d=g=[g,m]:(ke=d,d=n)):(ke=d,d=n);d!==n;)h.push(d),d=ke,g=ke,Me++,39===e.charCodeAt(ke)?(m=x,ke++):(m=n,0===Me&&peg$fail(_)),Me--,m===n?g=void 0:(ke=g,g=n),g!==n?(e.length>ke?(m=e.charAt(ke),ke++):(m=n,0===Me&&peg$fail(ge)),m!==n?d=g=[g,m]:(ke=d,d=n)):(ke=d,d=n);(u=h!==n?e.substring(u,ke):h)!==n?(39===e.charCodeAt(ke)?(h=x,ke++):(h=n,0===Me&&peg$fail(_)),h===n&&(h=ke,(d=peg$parseEOF())!==n&&(we=h,d=""),h=d),h!==n?(we=l,l=s=peg$c74(0,0,s,p,u,h)):(ke=l,l=n)):(ke=l,l=n)}else ke=l,l=n;else ke=l,l=n;if(l===n){if(l=ke,61===e.charCodeAt(ke)?(s=z,ke++):(s=n,0===Me&&peg$fail(P)),s!==n){for(p=ke,u=[],h=ke,d=ke,Me++,me.test(e.charAt(ke))?(g=e.charAt(ke),ke++):(g=n,0===Me&&peg$fail($e)),Me--,g===n?d=void 0:(ke=d,d=n),d!==n?(e.length>ke?(g=e.charAt(ke),ke++):(g=n,0===Me&&peg$fail(ge)),g!==n?h=d=[d,g]:(ke=h,h=n)):(ke=h,h=n);h!==n;)u.push(h),h=ke,d=ke,Me++,me.test(e.charAt(ke))?(g=e.charAt(ke),ke++):(g=n,0===Me&&peg$fail($e)),Me--,g===n?d=void 0:(ke=d,d=n),d!==n?(e.length>ke?(g=e.charAt(ke),ke++):(g=n,0===Me&&peg$fail(ge)),g!==n?h=d=[d,g]:(ke=h,h=n)):(ke=h,h=n);(p=u!==n?e.substring(p,ke):u)!==n?(we=l,l=s=peg$c77(0,0,s,p)):(ke=l,l=n)}else ke=l,l=n;l===n&&(l=ke,(s=ce)!==n&&(we=l,s=["","","",""]),l=s)}}l!==n?(we=a,a=o=peg$c79(0,o,l)):(ke=a,a=n)}else ke=a,a=n;for(a===n&&(a=ke,(o=peg$parse__())!==n&&(we=a,o=peg$c80(0,o)),(a=o)===n&&(a=ke,o=ke,l=ke,s=ke,Me++,41===e.charCodeAt(ke)?(p=A,ke++):(p=n,0===Me&&peg$fail(E)),Me--,p===n?s=void 0:(ke=s,s=n),s!==n?(p=ke,Me++,u=peg$parserbm(),Me--,u===n?p=void 0:(ke=p,p=n),p!==n?(e.length>ke?(u=e.charAt(ke),ke++):(u=n,0===Me&&peg$fail(ge)),u!==n?l=s=[s,p,u]:(ke=l,l=n)):(ke=l,l=n)):(ke=l,l=n),(o=l!==n?e.substring(o,ke):l)!==n&&(we=a,o=peg$c81(0,o)),a=o));a!==n;){if(i.push(a),a=ke,o=ke,l=[],he.test(e.charAt(ke))?(s=e.charAt(ke),ke++):(s=n,0===Me&&peg$fail(de)),s!==n)for(;s!==n;)l.push(s),he.test(e.charAt(ke))?(s=e.charAt(ke),ke++):(s=n,0===Me&&peg$fail(de));else l=n;if((o=l!==n?e.substring(o,ke):l)!==n){if(l=ke,61===e.charCodeAt(ke)?(s=z,ke++):(s=n,0===Me&&peg$fail(P)),s!==n)if(34===e.charCodeAt(ke)?(p=c,ke++):(p=n,0===Me&&peg$fail(f)),p!==n){for(u=ke,h=[],d=ke,g=ke,Me++,34===e.charCodeAt(ke)?(m=c,ke++):(m=n,0===Me&&peg$fail(f)),Me--,m===n?g=void 0:(ke=g,g=n),g!==n?(e.length>ke?(m=e.charAt(ke),ke++):(m=n,0===Me&&peg$fail(ge)),m!==n?d=g=[g,m]:(ke=d,d=n)):(ke=d,d=n);d!==n;)h.push(d),d=ke,g=ke,Me++,34===e.charCodeAt(ke)?(m=c,ke++):(m=n,0===Me&&peg$fail(f)),Me--,m===n?g=void 0:(ke=g,g=n),g!==n?(e.length>ke?(m=e.charAt(ke),ke++):(m=n,0===Me&&peg$fail(ge)),m!==n?d=g=[g,m]:(ke=d,d=n)):(ke=d,d=n);(u=h!==n?e.substring(u,ke):h)!==n?(34===e.charCodeAt(ke)?(h=c,ke++):(h=n,0===Me&&peg$fail(f)),h===n&&(h=ke,(d=peg$parseEOF())!==n&&(we=h,d=""),h=d),h!==n?(we=l,l=s=peg$c74(0,0,s,p,u,h)):(ke=l,l=n)):(ke=l,l=n)}else ke=l,l=n;else ke=l,l=n;if(l===n){if(l=ke,61===e.charCodeAt(ke)?(s=z,ke++):(s=n,0===Me&&peg$fail(P)),s!==n)if(39===e.charCodeAt(ke)?(p=x,ke++):(p=n,0===Me&&peg$fail(_)),p!==n){for(u=ke,h=[],d=ke,g=ke,Me++,39===e.charCodeAt(ke)?(m=x,ke++):(m=n,0===Me&&peg$fail(_)),Me--,m===n?g=void 0:(ke=g,g=n),g!==n?(e.length>ke?(m=e.charAt(ke),ke++):(m=n,0===Me&&peg$fail(ge)),m!==n?d=g=[g,m]:(ke=d,d=n)):(ke=d,d=n);d!==n;)h.push(d),d=ke,g=ke,Me++,39===e.charCodeAt(ke)?(m=x,ke++):(m=n,0===Me&&peg$fail(_)),Me--,m===n?g=void 0:(ke=g,g=n),g!==n?(e.length>ke?(m=e.charAt(ke),ke++):(m=n,0===Me&&peg$fail(ge)),m!==n?d=g=[g,m]:(ke=d,d=n)):(ke=d,d=n);(u=h!==n?e.substring(u,ke):h)!==n?(39===e.charCodeAt(ke)?(h=x,ke++):(h=n,0===Me&&peg$fail(_)),h===n&&(h=ke,(d=peg$parseEOF())!==n&&(we=h,d=""),h=d),h!==n?(we=l,l=s=peg$c74(0,0,s,p,u,h)):(ke=l,l=n)):(ke=l,l=n)}else ke=l,l=n;else ke=l,l=n;if(l===n){if(l=ke,61===e.charCodeAt(ke)?(s=z,ke++):(s=n,0===Me&&peg$fail(P)),s!==n){for(p=ke,u=[],h=ke,d=ke,Me++,me.test(e.charAt(ke))?(g=e.charAt(ke),ke++):(g=n,0===Me&&peg$fail($e)),Me--,g===n?d=void 0:(ke=d,d=n),d!==n?(e.length>ke?(g=e.charAt(ke),ke++):(g=n,0===Me&&peg$fail(ge)),g!==n?h=d=[d,g]:(ke=h,h=n)):(ke=h,h=n);h!==n;)u.push(h),h=ke,d=ke,Me++,me.test(e.charAt(ke))?(g=e.charAt(ke),ke++):(g=n,0===Me&&peg$fail($e)),Me--,g===n?d=void 0:(ke=d,d=n),d!==n?(e.length>ke?(g=e.charAt(ke),ke++):(g=n,0===Me&&peg$fail(ge)),g!==n?h=d=[d,g]:(ke=h,h=n)):(ke=h,h=n);(p=u!==n?e.substring(p,ke):u)!==n?(we=l,l=s=peg$c77(0,0,s,p)):(ke=l,l=n)}else ke=l,l=n;l===n&&(l=ke,(s=ce)!==n&&(we=l,s=["","","",""]),l=s)}}l!==n?(we=a,a=o=peg$c79(0,o,l)):(ke=a,a=n)}else ke=a,a=n;a===n&&(a=ke,(o=peg$parse__())!==n&&(we=a,o=peg$c80(0,o)),(a=o)===n&&(a=ke,o=ke,l=ke,s=ke,Me++,41===e.charCodeAt(ke)?(p=A,ke++):(p=n,0===Me&&peg$fail(E)),Me--,p===n?s=void 0:(ke=s,s=n),s!==n?(p=ke,Me++,u=peg$parserbm(),Me--,u===n?p=void 0:(ke=p,p=n),p!==n?(e.length>ke?(u=e.charAt(ke),ke++):(u=n,0===Me&&peg$fail(ge)),u!==n?l=s=[s,p,u]:(ke=l,l=n)):(ke=l,l=n)):(ke=l,l=n),(o=l!==n?e.substring(o,ke):l)!==n&&(we=a,o=peg$c81(0,o)),a=o))}i!==n?(41===e.charCodeAt(ke)?(a=A,ke++):(a=n,0===Me&&peg$fail(E)),a===n&&(a=ke,o=ke,Me++,l=peg$parserbm(),Me--,l!==n?(ke=o,o=void 0):o=n,o!==n&&(we=a,o=""),a=o),a!==n?(we=t,t=r={_type:"parenthesis",left:r,content:i,right:a}):(ke=t,t=n)):(ke=t,t=n)}else ke=t,t=n;t===n&&(t=ke,46===e.charCodeAt(ke)?(r=".",ke++):(r=n,0===Me&&peg$fail(be)),r===n&&(r=ce),r!==n&&(we=t,r={_type:"separator",separator:r}),t=r);return t}())!==n&&(o=peg$parsethings())!==n&&(l=function peg$parserbm_pop(){var e,t;e=ke,(t=peg$parserbm())!==n&&(we=e,r=t,Oe.pop(),t=r);var r;return e=t}())!==n?(we=t,t=r={type:"element",lbm:r,name:i,attributes:a,children:o,rbm:l,location:location()}):(ke=t,t=n);return t}())===n&&(t=function peg$parseverbatim(){var t,r,i,a,o;t=ke,(r=function peg$parselvm(){var t,r,i,a;t=ke,96===e.charCodeAt(ke)?(r=xe,ke++):(r=n,0===Me&&peg$fail(_e));if(r!==n){for(i=[],60===e.charCodeAt(ke)?(a=l,ke++):(a=n,0===Me&&peg$fail(s));a!==n;)i.push(a),60===e.charCodeAt(ke)?(a=l,ke++):(a=n,0===Me&&peg$fail(s));i!==n?(we=t,o=r,He=(p=i).length+1,t=r=o+p.join("")):(ke=t,t=n)}else ke=t,t=n;var o,p;return t}())!==n&&(i=function peg$parseverbatim_separator(){var t;46===e.charCodeAt(ke)?(t=ye,ke++):(t=n,0===Me&&peg$fail(be));t===n&&(t=ce);return t}())!==n&&(a=function peg$parseverbatim_text(){var t,r,i,a,o;t=ke,r=[],i=ke,a=ke,Me++,o=peg$parservm(),Me--,o===n?a=void 0:(ke=a,a=n);a!==n?(e.length>ke?(o=e.charAt(ke),ke++):(o=n,0===Me&&peg$fail(ge)),o!==n?(we=i,i=a=o):(ke=i,i=n)):(ke=i,i=n);for(;i!==n;)r.push(i),i=ke,a=ke,Me++,o=peg$parservm(),Me--,o===n?a=void 0:(ke=a,a=n),a!==n?(e.length>ke?(o=e.charAt(ke),ke++):(o=n,0===Me&&peg$fail(ge)),o!==n?(we=i,i=a=o):(ke=i,i=n)):(ke=i,i=n);r!==n&&(we=t,r=peg$c96(r));return t=r}())!==n&&(o=peg$parservm())!==n?(we=t,t=r={type:"verbatim",lvm:r,separator:i,child:a,rvm:o,location:location()}):(ke=t,t=n);return t}())===n&&(t=function peg$parsetext(){var t,r,i,a,o,l,s;t=ke,r=[],i=ke,a=ke,Me++,o=peg$parselbm(),Me--,o===n?a=void 0:(ke=a,a=n);a!==n?(o=ke,Me++,l=peg$parserbm(),Me--,l===n?o=void 0:(ke=o,o=n),o!==n?(l=ke,Me++,96===e.charCodeAt(ke)?(s=xe,ke++):(s=n,0===Me&&peg$fail(_e)),Me--,s===n?l=void 0:(ke=l,l=n),l!==n?(e.length>ke?(s=e.charAt(ke),ke++):(s=n,0===Me&&peg$fail(ge)),s!==n?(we=i,i=a=s):(ke=i,i=n)):(ke=i,i=n)):(ke=i,i=n)):(ke=i,i=n);if(i!==n)for(;i!==n;)r.push(i),i=ke,a=ke,Me++,o=peg$parselbm(),Me--,o===n?a=void 0:(ke=a,a=n),a!==n?(o=ke,Me++,l=peg$parserbm(),Me--,l===n?o=void 0:(ke=o,o=n),o!==n?(l=ke,Me++,96===e.charCodeAt(ke)?(s=xe,ke++):(s=n,0===Me&&peg$fail(_e)),Me--,s===n?l=void 0:(ke=l,l=n),l!==n?(e.length>ke?(s=e.charAt(ke),ke++):(s=n,0===Me&&peg$fail(ge)),s!==n?(we=i,i=a=s):(ke=i,i=n)):(ke=i,i=n)):(ke=i,i=n)):(ke=i,i=n);else r=n;r!==n&&(we=t,r=peg$c96(r));return t=r}()),t}function peg$parselbm(){var t,r,i,a,p,u;if(t=ke,91===e.charCodeAt(ke)?(r="[",ke++):(r=n,0===Me&&peg$fail(o)),r!==n){for(i=ke,a=[],60===e.charCodeAt(ke)?(p=l,ke++):(p=n,0===Me&&peg$fail(s));p!==n;)a.push(p),60===e.charCodeAt(ke)?(p=l,ke++):(p=n,0===Me&&peg$fail(s));(i=a!==n?e.substring(i,ke):a)!==n?(we=ke,u=i,(a=(a=(Oe[Oe.length-1]||0)<=u.length+1)?void 0:n)!==n?(we=t,t=r=function(e,t){return e+t}(r,i)):(ke=t,t=n)):(ke=t,t=n)}else ke=t,t=n;return t}function peg$parserbm(){var t,r,i,a,o;for(t=ke,r=ke,i=[],62===e.charCodeAt(ke)?(a=R,ke++):(a=n,0===Me&&peg$fail(D));a!==n;)i.push(a),62===e.charCodeAt(ke)?(a=R,ke++):(a=n,0===Me&&peg$fail(D));return(r=i!==n?e.substring(r,ke):i)!==n?(93===e.charCodeAt(ke)?(i="]",ke++):(i=n,0===Me&&peg$fail(ve)),i!==n?(we=ke,o=r,(a=(a=(Oe[Oe.length-1]||0)==o.length+1)?void 0:n)!==n?(we=t,t=r=function(e,t){return e+t}(r,i)):(ke=t,t=n)):(ke=t,t=n)):(ke=t,t=n),t===n&&(t=ke,(r=peg$parseEOF())!==n&&(we=t,r=""),t=r),t}function peg$parseEOF(){var t,r;return t=ke,Me++,e.length>ke?(r=e.charAt(ke),ke++):(r=n,0===Me&&peg$fail(ge)),Me--,r===n?t=void 0:(ke=t,t=n),t}function peg$parservm(){var t,r,i;for(t=ke,r=[],62===e.charCodeAt(ke)?(i=R,ke++):(i=n,0===Me&&peg$fail(D));i!==n;)r.push(i),62===e.charCodeAt(ke)?(i=R,ke++):(i=n,0===Me&&peg$fail(D));return r!==n?(96===e.charCodeAt(ke)?(i=xe,ke++):(i=n,0===Me&&peg$fail(_e)),i!==n?(we=ke,(He==r.length+1?void 0:n)!==n?(we=t,t=r=function(e,t){return e.join("")+t}(r,i)):(ke=t,t=n)):(ke=t,t=n)):(ke=t,t=n),t===n&&(t=ke,(r=peg$parseEOF())!==n&&(we=t,r=""),t=r),t}function peg$parse__(){var t,r,i;if(t=ke,r=[],Ae.test(e.charAt(ke))?(i=e.charAt(ke),ke++):(i=n,0===Me&&peg$fail(Ee)),i!==n)for(;i!==n;)r.push(i),Ae.test(e.charAt(ke))?(i=e.charAt(ke),ke++):(i=n,0===Me&&peg$fail(Ee));else r=n;return t=r!==n?e.substring(t,ke):r}var He,Oe=[];if((r=a())!==n&&ke===e.length)return r;throw r!==n&&ke<e.length&&peg$fail({type:"end"}),peg$buildStructuredError(je,Te<e.length?e.charAt(Te):null,Te<e.length?peg$computeLocation(Te,Te+1):peg$computeLocation(Te,Te))}}},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(r(12)),a=n(r(7)),o=n(r(1)),l=n(r(2)),s=n(r(0)),p=n(r(3)),u=n(r(6)),c=n(r(5));var f=new l.default({name:"[root]",display:"container-block",renderer:e=>e.html(e.innerHtml)});t.default={ast2nt:function ast2nt(e,t){t||(t={}),t.tags||(t.tags={});var r=a.default.tags(i.default,t.tags),n=function recurse(e){if("root"==e.type)return f.instantiate({code:e.code,attributes:[],children:e.children.map(recurse),options:t});if("text"==e.type)return new u.default(e.text);if("error"==e.type)return new p.default({message:"Parser error",code:e.text});if("element"==e.type){if(e.name in r&&r[e.name]){if(r[e.name].split){var recurseSplit=(e,t)=>{if(0==t.length)return e.map(recurse);var r,n=t[t.length-1],i=[];(e=e.map((e=>"element"!=e.type||e.name!=n||e.children.length?e:{type:"delimiter"}))).length&&"text"==e[0].type&&!e[0].text.trim()&&(e=e.slice(1)),e.length&&"delimiter"==e[0].type||e.unshift({type:"delimiter"});for(var a=0;a<e.length;a++)"delimiter"==e[a].type?(r&&i.push(r),r=[]):r.push(e[a]);return i.push(r),i.map((e=>recurseSplit(e,t.slice(0,-1))))};return r[e.name].instantiate({code:e.code,attributes:e.attributes,children:recurseSplit(e.children,r[e.name].split),options:t})}return r[e.name].instantiate({code:e.code,attributes:e.attributes,children:e.children.map(recurse),options:t})}return new p.default({message:e.name?`Undefined tag name [${e.name}]`:"No tag name",code:e.code})}throw TypeError(e.type)}(e.root);return n.render(),n},Node:s.default,TextNode:u.default,HtmlNode:c.default,ErrorNode:p.default,ElementClass:l.default,Element:o.default}},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(r(2));var a={};function normalizeUrl(e){return e=e.trim(),/^#/.test(e)?!!/^#[^\s]*$/.test(e)&&e:/^(\/|\.\/|\.\.\/)/.test(e)?!!/^(\/|\.\/|\.\.\/)[^\s]*$/.test(e)&&e:(/^(http:\/\/|https:\/\/|ftp:\/\/)/.test(e)||(e="http://"+e),!!/^(http:\/\/|https:\/\/|ftp:\/\/)[a-z0-9]+(-+[a-z0-9]+)*(\.[a-z0-9]+(-+[a-z0-9]+)*)+\.?(:[0-9]{1,5})?(\/[^\s]*)?$/.test(e)&&e)}a.comment=new i.default({name:"comment",display:"inline",renderer:e=>e.text("")}),a.entity=new i.default({name:"entity",display:"inline",renderer:e=>e.innerIsText?/^([a-z]{1,50}|#[0-9]{1,10}|#x[0-9a-f]{1,10})$/i.test(e.innerText)?e.html(`&${e.innerText};`):e.error("Invalid value"):e.error("Non-text input")}),["b","code","i","u","sup","sub"].forEach((e=>a[e]=new i.default({name:e,display:"inline",renderer:t=>t.html(`<${e}>${t.innerHtml}</${e}>`)}))),["h1","h2","h3","h4","h5","h6","p"].forEach((e=>a[e]=new i.default({name:e,display:"leaf-block",renderer:t=>t.html(`<${e}>${t.innerHtml}</${e}>`)}))),a.blockquote=new i.default({name:"blockquote",display:"container-block",renderer:e=>{var t=e.getAttribute("type");return["info","warn"].includes(t)?e.html(`<blockquote class="m42kup-bq-${t}">${e.innerHtml}</blockquote>`):e.html(`<blockquote>${e.innerHtml}</blockquote>`)}}),["br"].forEach((e=>a[e]=new i.default({name:e,display:"inline",renderer:t=>t.html(`<${e}>${t.innerHtml}`)}))),["hr"].forEach((e=>a[e]=new i.default({name:e,display:"leaf-block",renderer:t=>t.html(`<${e}>${t.innerHtml}`)}))),["ul","ol"].forEach((e=>{a[e]=new i.default({name:e,display:"container-block",split:"*",renderer:t=>t.html(`<${e}>`+t.innerHtml.map((e=>`<li>${e}</li>`)).join("")+`</${e}>`)})})),a.table=new i.default({name:"table",display:"container-block",split:["*","**"],renderer:e=>{var t=e.innerHtml.map((e=>e.length)).reduce(((e,t)=>e<t?t:e));return e.html("<table>"+e.innerHtml.map((e=>`<tr>${e.concat(Array(t-e.length).fill("")).map((e=>`<td>${e}</td>`)).join("")}</tr>`)).join("")+"</table>")}}),a.blockcode=new i.default({name:"blockcode",display:"leaf-block",renderer:e=>{var t=e.innerHtml.replace(/(^[ \t]*(\r\n|\r|\n))|((\r\n|\r|\n)[ \t]*$)/g,"");return e.html(`<pre><code>${t}\n</code></pre>`)}}),a.bi=new i.default({name:"bi",display:"inline",renderer:e=>e.html(`<i><b>${e.innerHtml}</b></i>`)}),a.link=new i.default({name:"link",display:"inline",renderer:e=>{var t=e.getAttribute("href");if(null==t){if(!e.innerIsText)return e.error("Non-text input");let t=normalizeUrl(e.innerText);if(!t)return e.error("Invalid URL");let r=e.escapeHtml(t);return e.html(`<a href="${r}" title="${r}">${r}</a>`)}{let r=normalizeUrl(t);if(!r)return e.error("Invalid URL");let n=e.escapeHtml(r);return e.html(`<a href="${n}" title="${n}">${e.innerHtml}</a>`)}}}),a.img=new i.default({name:"img",display:"leaf-block",renderer:e=>{if(!e.innerIsText)return e.error("Non-text input");var t=normalizeUrl(e.innerText);if(!t)return e.error("Invalid URL");var r=e.escapeHtml(t);return e.html(`<img src="${r}">`)}}),["squote","dquote"].forEach((e=>a[e]=new i.default({name:e,display:"inline",renderer:t=>{var r={squote:{normal:["‘","’"],angle:["〈","〉"],corner:["「","」"]},dquote:{normal:["“","”"],angle:["《","》"],corner:["『","』"]}},n=t.getAttribute("type");return["angle","corner"].includes(n)||(n="normal"),t.html(`${r[e][n][0]}${t.innerHtml}${r[e][n][1]}`)}}))),a.highlight=new i.default({name:"highlight",display:"leaf-block",renderer:(e,t)=>{if(!t.hljs)return e.error("Element not implemented (options.highlight not given)");if(!e.innerIsText)return e.error("Non-text input");var r,n=["apache","bash","coffeescript","cpp","cs","css","diff","http","ini","java","javascript","json","makefile","xml","markdown","nginx","objectivec","perl","php","python","ruby","sql"],i=e.innerText.replace(/(^[ \t]*(\r\n|\r|\n))|((\r\n|\r|\n)[ \t]*$)/g,"");if(n.includes(e.getAttribute("lang"))){var a=e.getAttribute("lang");r=t.hljs.highlight(a,i).value}else r=t.hljs.highlightAuto(i,n).value;return e.html(`<pre class="hljs"><code>${r}\n</code></pre>`)}}),a.math=new i.default({name:"math",display:"inline",renderer:(e,t)=>{if(!t.katex)return e.error("Element not implemented (options.katex not given)");if(!e.innerIsText)return e.error("Non-text input");var r=t.katex.renderToString(e.innerText,{throwOnError:!1,displayMode:!1,strict:"error"});return e.html(r)}}),a.displaymath=new i.default({name:"displaymath",display:"leaf-block",renderer:(e,t)=>{if(!t.katex)return e.error("Element not implemented (options.katex not given)");if(!e.innerIsText)return e.error("Non-text input");var r=t.katex.renderToString(e.innerText,{throwOnError:!1,displayMode:!0,strict:"error"});return e.html(r)}});var o={'"':"dquote",$:"math",$$:"displaymath","%":"comment","&":"entity","'":"squote","*":"i","**":"b","***":"bi",";":"code",";;":"blockcode",";;;":"highlight","=":"h1","==":"h2","===":"h3","====":"h4","=====":"h5","======":"h6",">":"blockquote","\\":"br","^":"sup",_:"sub","~":"link","~~":"img"};for(var l in o){if(!a[o[l]])throw TypeError("aliasing failed");a[l]=a[o[l]]}t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function makeHtml(e){return`<span class="m42hl-${e.type}">${e.html||(t=e.text,(t+"").replace(/[&<>"']/g,(e=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[e]))))}</span>`;var t}t.default={pt2hl:function pt2hl(e){return function recurse(e){for(var t="",r=0;r<e.length;r++)switch(e[r].type){case"text":t+=makeHtml({type:"tx",text:e[r].text});break;case"element":var n=makeHtml({type:"lbm",text:e[r].lbm})+makeHtml({type:"tn",text:e[r].name})+(e=>{switch(e._type){case"parenthesis":return makeHtml({type:"lpm",text:e.left})+e.content.map((e=>{switch(e._type){case"attribute":return makeHtml({type:"pk",text:e.attribute[0]})+makeHtml({type:"eq",text:e.attribute[1]})+makeHtml({type:"lqm",text:e.attribute[2]})+makeHtml({type:"pv",text:e.attribute[3]})+makeHtml({type:"rqm",text:e.attribute[4]});case"whitespace":return makeHtml({type:"tx",text:e.whitespace});case"error":return makeHtml({type:"err",text:e.error});default:throw Error("Unknown type")}})).join("")+makeHtml({type:"rpm",text:e.right});case"separator":return makeHtml({type:"sp",text:e.separator});default:throw Error("Unknown type")}})(e[r].attributes)+recurse(e[r].children)+makeHtml({type:"rbm",text:e[r].rbm});t+=makeHtml({type:"elem",html:n});break;case"verbatim":var i=makeHtml({type:"lvm",text:e[r].lvm+e[r].separator})+makeHtml({type:"tx",text:e[r].child.text})+makeHtml({type:"rvm",text:e[r].rvm});t+=makeHtml({type:"verb",html:i});break;default:throw new TypeError(`Unknown type: ${e[r].type}`)}return t}(e.root.children)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=4,i=5;t.default=function addCodeMirrorMode(e){function token(e,t){if((t.levels[t.levels.length-1]||0)<0){var r=-t.levels[t.levels.length-1],a=">".repeat(r-1)+"`";return e.skipTo(a)?(e.match(a),t.levels.pop()):e.skipToEnd(),"comment"}var o=e.peek();if(![n,i].includes(t.status)&&[">","]"].includes(o)&&(p=t.levels[t.levels.length-1]||0)>0){var l=">".repeat(p-1)+"]";if(e.match(l))return t.levels.pop(),t.status=0,"tag"}if(0!=t.status){if(e.match(")"))return t.status=0,"tag";if(1==t.status)return e.match(/^[a-z0-9-]+/)?(t.status=2,"attribute"):e.match(/^[ \t\n\r]+/)?null:(e.next(),"error");if(2==t.status)return e.match("=")?(t.status=3,null):(t.status=1,null);if(3==t.status)return e.match('"')?(t.status=n,"string"):e.match("'")?(t.status=i,"string"):(e.match(/^[^'"()\[\] \t\n\r]*/),t.status=1,"string");if(t.status==n)return e.skipTo('"')?(e.match('"'),t.status=1):e.skipToEnd(),"string";if(t.status==i)return e.skipTo("'")?(e.match("'"),t.status=1):e.skipToEnd(),"string"}if("`"==o){e.next();for(var s=1;o=e.next();){if("<"!=o){e.backUp(1);break}s++}return t.levels.push(-s),"comment"}if("["==o){e.next();for(s=1;o=e.next();){if("<"!=o){e.backUp(1);break}s++}if(s<(t.levels[t.levels.length-1]||0))return null;if(e.match(/^(?:\!+|\"+|\#+|\$+|\%+|\&+|\'+|\)+|\*+|\++|\,+|\-+|\/+|\;+|\=+|\>+|\?+|\@+|\\+|\^+|\_+|\{+|\|+|\}+|\~+|[a-z][a-z0-9]*(?:\:[a-z][a-z0-9]*)*|)/),e.match("("))t.status=1;else{e.match(/^(?:[.]|)/i)}return t.levels.push(s),"tag"}if(">"==o||"]"==o){var p;if((p=t.levels[t.levels.length-1]||0)<=0)return e.next(),null;l=">".repeat(p-1)+"]";return e.match(l)?(t.levels.pop(),"tag"):(e.next(),null)}e.match(/^[^\[\]`>]+/)}e.defineMode("m42kup",((e,t)=>({startState:e=>({levels:[],status:0}),token:token})))}}])}));
//# sourceMappingURL=m42kup.min.js.map